<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eon Forge - Offer Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4361ee',
            'primary-dark': '#3a56d4',
            secondary: '#3b82f6',
            accent: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'modal-enter': 'modalEnter 0.3s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            modalEnter: {
              '0%': { opacity: '0', transform: 'scale(0.95) translateY(20px)' },
              '100%': { opacity: '1', transform: 'scale(1) translateY(0)' },
            },
          },
        },
      },
    }
  </script>
  <style>
    .dropdown {
      display: none;
    }

    .dropdown-container:hover .dropdown {
      display: block;
    }

    .table-row:hover {
      background: linear-gradient(to right, rgba(243, 244, 246, 0.8), rgba(249, 250, 251, 0.8));
    }

    .stats-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .stats-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    .sidebar-menu a.active {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .search-container {
      transition: all 0.3s ease;
    }

    .search-container:focus-within {
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }

    .modal-overlay {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }

    .modal-content {
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .input-field {
      transition: all 0.3s ease;
    }

    .input-field:focus {
      border-color: #4361ee;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
  </style>
</head>

<body class="font-sans bg-gray-100 text-gray-900">
  <div class="flex min-h-screen">
    <%- include("../../views/partials/admin/sidebar") %>

      <div class="flex-1 ml-64">
        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-40 px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <button class="md:hidden text-gray-600 hover:text-primary">
                <i class="fas fa-bars text-xl"></i>
              </button>
              <form action="/admin/offers" method="get"
                class="search-container flex items-center bg-gray-100 rounded-full px-4 py-2">
                <input type="text" name="search" placeholder="Search offers..."
                  class="bg-transparent border-none focus:outline-none text-sm w-64 input-field"
                  value="<%= typeof search !== 'undefined' ? search : '' %>">
                <button type="submit" class="text-gray-500 hover:text-primary">
                  <i class="fas fa-search"></i>
                </button>
                <% if(search) { %>
                  <a href="/admin/offers" class="ml-2 text-gray-500 hover:text-danger">
                    <i class="fas fa-times"></i>
                  </a>
                  <% } %>
              </form>
            </div>
            <div class="dropdown-container relative">
              <button class="flex items-center gap-2 text-gray-700 hover:text-primary p-2 rounded-lg hover:bg-gray-100">
                <i class="fas fa-user"></i>
                <span class="text-sm font-medium">Admin</span>
              </button>
              <div class="dropdown absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-100">
                <a href="/profile" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                  <i class="fas fa-user text-primary"></i> Profile
                </a>
                <a href="/admin/logout"
                  class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                  <i class="fas fa-sign-out-alt text-danger"></i> Logout
                </a>
              </div>
            </div>
          </div>
        </header>

        <!-- Main Content -->
        <main class="p-6">
          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stats-card bg-white rounded-xl p-6 shadow-lg animate-slide-up">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-600">Total Offers</p>
                  <h3 class="text-2xl font-bold text-primary">
                    <%= totalOffers || 0 %>
                  </h3>
                </div>
                <div class="bg-primary/10 p-3 rounded-full">
                  <i class="fas fa-tags text-primary text-xl"></i>
                </div>
              </div>
            </div>
            <div class="stats-card bg-white rounded-xl p-6 shadow-lg animate-slide-up">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-600">Active Offers</p>
                  <h3 class="text-2xl font-bold text-accent">
                    <%= activeOffers || 0 %>
                  </h3>
                </div>
                <div class="bg-accent/10 p-3 rounded-full">
                  <i class="fas fa-check-circle text-accent text-xl"></i>
                </div>
              </div>
            </div>
            <div class="stats-card bg-white rounded-xl p-6 shadow-lg animate-slide-up">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-600">Expired Offers</p>
                  <h3 class="text-2xl font-bold text-warning">
                    <%= expiredOffers || 0 %>
                  </h3>
                </div>
                <div class="bg-warning/10 p-3 rounded-full">
                  <i class="fas fa-hourglass-end text-warning text-xl"></i>
                </div>
              </div>
            </div>
            <div class="stats-card bg-white rounded-xl p-6 shadow-lg animate-slide-up">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-600">Total Discount</p>
                  <h3 class="text-2xl font-bold text-secondary">₹<%= totalDiscount ? totalDiscount.toFixed(2) : '0.00'
                      %>
                  </h3>
                </div>
                <div class="bg-secondary/10 p-3 rounded-full">
                  <i class="fas fa-indian-rupee-sign text-secondary text-xl"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Filters and Header -->
          <div class="flex justify-between items-center mb-6">
            <div>
              <h1 class="text-3xl font-bold text-gray-800">Offer Management</h1>
              <p class="text-gray-600 text-sm">Create and manage promotional offers</p>
            </div>
            <div class="flex gap-4">
              <select id="status-filter" name="status"
                class="px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field">
                <option value="">All Statuses</option>
                <option value="Active">Active</option>
                <option value="Expired">Expired</option>
                <option value="Scheduled">Scheduled</option>
                <option value="Inactive">Inactive</option>
              </select>
              <select id="sort-order" name="sort"
                class="px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field">
                <option value="desc">Newest First</option>
                <option value="asc">Oldest First</option>
              </select>
              <button onclick="openCreateOfferModal()"
                class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark text-sm flex items-center gap-2">
                <i class="fas fa-plus"></i> Create Offer
              </button>
            </div>
          </div>

          <!-- Offers Table -->
          <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Offer Title</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Type</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Target Name</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Discount</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Start Date</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">End Date</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Status</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% offers.forEach((offer, index)=> { %>
                    <tr class="table-row border-t border-gray-100">
                      <td class="px-6 py-4 text-sm font-medium text-gray-900">
                        <%= offer.title %>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-700">
                        <%= offer.type %>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-700">
                        <%= offer.targetName %>
                      </td>
                      <td class="px-6 py-4 text-sm font-semibold text-gray-900">
                        <%= offer.discountType==='Percentage' ? `${offer.discountValue}%` : `₹${offer.discountValue}` %>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-700">
                        <%= new Date(offer.startDate).toLocaleDateString() %>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-700">
                        <%= new Date(offer.endDate).toLocaleDateString() %>
                      </td>
                      <td class="px-6 py-4">
                        <% const statusStyles={ 'Active' : 'bg-green-100 text-green-800' , 'Expired'
                          : 'bg-red-100 text-red-800' , 'Scheduled' : 'bg-yellow-100 text-yellow-800' , 'Inactive'
                          : 'bg-gray-100 text-gray-800' }; const statusIcons={ 'Active' : 'fa-check-circle' , 'Expired'
                          : 'fa-times-circle' , 'Scheduled' : 'fa-clock' , 'Inactive' : 'fa-ban' }; %>
                          <span
                            class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium <%= statusStyles[offer.status] %>">
                            <i class="fas <%= statusIcons[offer.status] %> mr-1"></i>
                            <%= offer.status %>
                          </span>
                      </td>
                      <td class="px-6 py-4 flex items-center gap-2">
                        <button
                          onclick="openEditOfferModal('<%= offer._id %>', '<%= offer.title %>', '<%= offer.type %>', '<%= offer.targetName %>', '<%= offer.discountType %>', '<%= offer.discountValue %>', '<%= offer.startDate %>', '<%= offer.endDate %>', '<%= offer.status %>')"
                          class="text-primary hover:text-primary-dark text-sm font-medium px-3 py-1 rounded-lg hover:bg-primary/10">
                          <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                        <button onclick="deleteOffer('<%= offer._id %>')"
                          class="text-danger hover:text-danger-dark text-sm font-medium px-3 py-1 rounded-lg hover:bg-danger/10">
                          <i class="fas fa-trash mr-1"></i>Delete
                        </button>
                        <% if (offer.isActive) { %>
                          <button onclick="toggleOfferStatus('<%= offer._id %>', false)"
                            class="text-warning hover:text-warning-dark text-sm font-medium px-3 py-1 rounded-lg hover:bg-warning/10">
                            <i class="fas fa-ban mr-1"></i>Block
                          </button>
                          <% } else { %>
                            <button onclick="toggleOfferStatus('<%= offer._id %>', true)"
                              class="text-accent hover:text-accent-dark text-sm font-medium px-3 py-1 rounded-lg hover:bg-accent/10">
                              <i class="fas fa-check mr-1"></i>Unblock
                            </button>
                            <% } %>

                      </td>
                    </tr>
                    <% }); %>
                </tbody>
              </table>
            </div>
            <!-- Pagination -->
            <div class="flex items-center justify-center gap-2 p-4 bg-gray-50 border-t border-gray-200">
              <a href="?page=<%= currentPage - 1 %>&search=<%= search || '' %>&status=<%= status || '' %>&sort=<%= sort || 'desc' %>"
                class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 hover:bg-primary hover:text-white <%= currentPage === 1 ? 'opacity-50 pointer-events-none' : '' %>">
                <i class="fas fa-chevron-left"></i>
              </a>
              <% for(let i=1; i <=totalPages; i++) { %>
                <a href="?page=<%= i %>&search=<%= search || '' %>&status=<%= status || '' %>&sort=<%= sort || 'desc' %>"
                  class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 text-sm <%= i === currentPage ? 'bg-primary text-white' : 'hover:bg-gray-100' %>">
                  <%= i %>
                </a>
                <% } %>
                  <a href="?page=<%= currentPage + 1 %>&search=<%= search || '' %>&status=<%= status || '' %>&sort=<%= sort || 'desc' %>"
                    class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 hover:bg-primary hover:text-white <%= currentPage >= totalPages ? 'opacity-50 pointer-events-none' : '' %>">
                    <i class="fas fa-chevron-right"></i>
                  </a>
            </div>
          </div>
        </main>
      </div>
  </div>

  <!-- Create Offer Modal -->
  <div id="create-offer-modal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl modal-content w-full max-w-lg animate-modal-enter">
      <div
        class="p-6 border-b border-gray-200 bg-gradient-to-r from-primary to-secondary text-white flex justify-between items-center rounded-t-2xl">
        <h2 class="text-xl font-semibold">Create New Offer</h2>
        <button onclick="closeCreateOfferModal()" class="text-white hover:text-gray-200">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
      <form id="create-offer-form" class="p-6 space-y-4">
        <div>
          <label for="create-title" class="block text-sm font-medium text-gray-700 mb-1">Offer Title</label>
          <input type="text" id="create-title" name="title"
            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
            placeholder="e.g., Summer Sale" >
        </div>
        <div>
          <label for="create-type" class="block text-sm font-medium text-gray-700 mb-1">Type</label>
          <select id="create-type" name="targetType"
            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
            required>
            <option value="Category">Category</option>
            <option value="Product">Product</option>
          </select>
        </div>
        <div>
          <label for="create-target-name" class="block text-sm font-medium text-gray-700 mb-1">Target Name</label>
          <input type="text" id="create-target-name" name="targetName"
            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
            placeholder="e.g., Men or Watch">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="create-discount-type" class="block text-sm font-medium text-gray-700 mb-1">Discount Type</label>
            <select id="create-discount-type" name="discountType"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field">
              <option value="Percentage">Percentage</option>
              <option value="Flat">Flat</option>
            </select>
          </div>
          <div>
            <label for="create-discount-value" class="block text-sm font-medium text-gray-700 mb-1">Discount
              Value</label>
            <input type="number" id="create-discount-value" name="discountValue"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
              placeholder="e.g., 20" min="0" required>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="create-start-date" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
            <input type="date" id="create-start-date" name="startDate"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
              required>
          </div>
          <div>
            <label for="create-end-date" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
            <input type="date" id="create-end-date" name="endDate"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
              required>
          </div>
        </div>
        <div class="flex justify-end gap-3">
          <button type="button" onclick="closeCreateOfferModal()"
            class="px-4 py-2 border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50 text-sm">
            Cancel
          </button>
          <button type="submit"
            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark text-sm flex items-center gap-2">
            <i class="fas fa-save"></i> Create
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Offer Modal -->
  <div id="edit-offer-modal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl modal-content w-full max-w-lg animate-modal-enter">
      <div
        class="p-6 border-b border-gray-200 bg-gradient-to-r from-primary to-secondary text-white flex justify-between items-center rounded-t-2xl">
        <h2 class="text-xl font-semibold">Edit Offer</h2>
        <button onclick="closeEditOfferModal()" class="text-white hover:text-gray-200">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
      <form id="edit-offer-form" class="p-6 space-y-4">
        <input type="hidden" id="edit-offer-id" name="offerId">
        <div>
          <label for="edit-title" class="block text-sm font-medium text-gray-700 mb-1">Offer Title</label>
          <input type="text" id="edit-title" name="title"
            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
            required>
        </div>
        <div>
          <label for="edit-type" class="block text-sm font-medium text-gray-700 mb-1">Type</label>
          <select id="edit-type" name="type"
            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
            required>
            <option value="Category">Category</option>
            <option value="Product">Product</option>
          </select>
        </div>
        <div>
          <label for="edit-target-name" class="block text-sm font-medium text-gray-700 mb-1">Target Name</label>
          <input type="text" id="edit-target-name" name="targetName"
            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
            required>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="edit-discount-type" class="block text-sm font-medium text-gray-700 mb-1">Discount Type</label>
            <select id="edit-discount-type" name="discountType"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field">
              <option value="percentage">Percentage</option>
              <option value="fixed">Fixed Amount</option>
            </select>
          </div>
          <div>
            <label for="edit-discount-value" class="block text-sm font-medium text-gray-700 mb-1">Discount Value</label>
            <input type="number" id="edit-discount-value" name="discountValue"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
              min="0" required>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="edit-start-date" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
            <input type="date" id="edit-start-date" name="startDate"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
              required>
          </div>
          <div>
            <label for="edit-end-date" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
            <input type="date" id="edit-end-date" name="endDate"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field"
              required>
          </div>
        </div>
        <div>
          <label for="edit-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
          <select id="edit-status" name="status"
            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary input-field">
            <option value="Active">Active</option>
            <option value="Expired">Expired</option>
            <option value="Scheduled">Scheduled</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>
        <div class="flex justify-end gap-3">
          <button type="button" onclick="closeEditOfferModal()"
            class="px-4 py-2 border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50 text-sm">
            Cancel
          </button>
          <button type="submit"
            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark text-sm flex items-center gap-2">
            <i class="fas fa-save"></i> Update
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    function openCreateOfferModal() {
      document.getElementById('create-offer-modal').classList.remove('hidden');
    }

    function closeCreateOfferModal() {
      document.getElementById('create-offer-modal').classList.add('hidden');
      document.getElementById('create-offer-form').reset();
    }

    function openEditOfferModal(id, title, type, targetName, discountType, discountValue, startDate, endDate, status) {
      document.getElementById('edit-offer-modal').classList.remove('hidden');
      document.getElementById('edit-offer-id').value = id;
      document.getElementById('edit-title').value = title;
      document.getElementById('edit-type').value = type;
      document.getElementById('edit-target-name').value = targetName;
      document.getElementById('edit-discount-type').value = discountType;
      document.getElementById('edit-discount-value').value = discountValue;
      document.getElementById('edit-start-date').value = startDate.split('T')[0];
      document.getElementById('edit-end-date').value = endDate.split('T')[0];
      document.getElementById('edit-status').value = status;
    }

    function closeEditOfferModal() {
      document.getElementById('edit-offer-modal').classList.add('hidden');
      document.getElementById('edit-offer-form').reset();
    }

    document.getElementById('create-offer-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);

      try {
        const res = await fetch('/admin/addOffer', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success) {
          Swal.fire('Success', 'Offer created successfully!', 'success').then(() => {
            closeCreateOfferModal();
            location.reload();
          });
        } else {
          Swal.fire('Error', result.message || 'Failed to create offer', 'error');
        }
      } catch (err) {
        Swal.fire('Error', 'Failed to create offer', 'error');
      }
    });

    document.getElementById('edit-offer-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);
      const offerId = data.offerId;

      try {
        const res = await fetch(`/admin/offers/${offerId}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success) {
          Swal.fire('Success', 'Offer updated successfully!', 'success').then(() => {
            closeEditOfferModal();
            location.reload();
          });
        } else {
          Swal.fire('Error', result.message || 'Failed to update offer', 'error');
        }
      } catch (err) {
        Swal.fire('Error', 'Failed to update offer', 'error');
      }
    });

    async function deleteOffer(offerId) {
      const result = await Swal.fire({
        title: 'Are you sure?',
        text: 'This action cannot be undone!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'Yes, delete it!'
      });

      if (result.isConfirmed) {
        try {
          const res = await fetch(`/admin/offers/${offerId}`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' }
          });
          const data = await res.json();
          if (data.success) {
            Swal.fire('Success', 'Offer deleted successfully!', 'success').then(() => location.reload());
          } else {
            Swal.fire('Error', data.message || 'Failed to delete offer', 'error');
          }
        } catch (err) {
          Swal.fire('Error', 'Failed to delete offer', 'error');
        }
      }
    }

    async function toggleOfferStatus(offerId, newStatus) {
      const action = newStatus === 'Active' ? 'unblock' : 'block';
      const result = await Swal.fire({
        title: `Are you sure you want to ${action} this offer?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#4361ee',
        cancelButtonColor: '#6b7280',
        confirmButtonText: `Yes, ${action} it!`
      });

      if (result.isConfirmed) {
        try {
          const res = await fetch(`/admin/offers/${offerId}/status`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status: newStatus })
          });
          const data = await res.json();
          if (data.success) {
            Swal.fire('Success', `Offer ${action}ed successfully!`, 'success').then(() => location.reload());
          } else {
            Swal.fire('Error', data.message || `Failed to ${action} offer`, 'error');
          }
        } catch (err) {
          Swal.fire('Error', `Failed to ${action} offer`, 'error');
        }
      }
    }

    function applyFilters() {
      const status = document.getElementById('status-filter').value;
      const sort = document.getElementById('sort-order').value;
      const search = document.querySelector('input[name="search"]').value;
      window.location.href = `/admin/offers?search=${encodeURIComponent(search)}&status=${status}&sort=${sort}`;
    }

    document.getElementById('status-filter').addEventListener('change', applyFilters);
    document.getElementById('sort-order').addEventListener('change', applyFilters);
  </script>
</body>

</html>